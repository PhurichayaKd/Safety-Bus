<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏à‡πâ‡∏á‡∏•‡∏≤ - Safety Bus</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="./js/supabase-config.js"></script>
    <link rel="stylesheet" href="./css/date-picker.css">
    <style>
        .test-mode {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            text-align: center;
        }
        .test-mode h3 {
            color: #856404;
            margin: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="test-mode">
            <h3>üß™ ‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏î‡∏™‡∏≠‡∏ö - ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ LINE</h3>
            <p>‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö LINE</p>
        </div>

        <!-- Loading Screen -->
        <div id="loading-screen" class="loading-screen" style="display: none;">
            <div class="loading-spinner"></div>
            <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
        </div>

        <!-- Main Form Section -->
        <div id="main-form" class="main-form">
            <div class="header">
                <h1>üöå Safety Bus</h1>
                <h2>üìù ‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏à‡πâ‡∏á‡∏•‡∏≤‡∏´‡∏¢‡∏∏‡∏î</h2>
            </div>
            
            <!-- Student Info Card -->
            <div class="student-card">
                <h3>üë§ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>
                <div class="student-details">
                    <div class="info-row">
                        <span class="label">‡∏ä‡∏∑‡πà‡∏≠:</span>
                        <span id="student-name" class="value">‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏î‡∏™‡∏≠‡∏ö</span>
                    </div>
                    <div class="info-row">
                        <span class="label">‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:</span>
                        <span id="student-code" class="value">12345</span>
                    </div>
                </div>
            </div>

            <!-- Date Selection Section -->
            <div class="date-selection-card">
                <h3>üìÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏à‡πâ‡∏á‡∏•‡∏≤</h3>
                <p class="instruction">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 3 ‡∏ß‡∏±‡∏ô</p>
                
                <div class="date-input-wrapper">
                    <label for="leave-date">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏≤:</label>
                    <div class="date-input-group">
                        <input type="date" id="leave-date" name="leave-date">
                        <button id="add-date-btn" class="add-date-button">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
                    </div>
                </div>
                
                <div id="selected-dates" class="selected-dates">
                    <h4>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å:</h4>
                    <div id="selected-dates-list" class="selected-dates-list">
                        <p class="no-dates">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</p>
                    </div>
                </div>
            </div>

            <div class="button-container">
                <button id="confirm-btn" class="confirm-button" disabled>
                    ‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                </button>
            </div>
        </div>

        <!-- Confirmation Section -->
        <div id="confirmation-section" class="confirmation-section" style="display: none;">
            <div class="confirmation-header">
                <h3>üìã ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏•‡∏≤</h3>
                <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á</p>
            </div>
            
            <div class="confirmation-details">
                <div class="student-summary">
                    <p><strong>üë§ ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:</strong> <span id="confirm-student-name">‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏î‡∏™‡∏≠‡∏ö</span></p>
                    <p><strong>üÜî ‡∏£‡∏´‡∏±‡∏™:</strong> <span id="confirm-student-code">12345</span></p>
                </div>
                
                <div class="dates-summary">
                    <p><strong>üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏≤:</strong></p>
                    <div id="confirm-dates-list" class="confirm-dates-list"></div>
                </div>
                
                <div class="reason-summary">
                    <p><strong>üìù ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•:</strong> ‡πÑ‡∏°‡πà‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏Ç‡∏∂‡πâ‡∏ô‡∏£‡∏ñ‡∏ö‡∏±‡∏™‡∏£‡∏±‡∏ö-‡∏™‡πà‡∏á‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏î‡∏±‡∏á‡∏Å‡∏•‡πà‡∏≤‡∏ß</p>
                </div>
            </div>
            
            <div class="button-container">
                <button id="final-confirm-btn" class="final-confirm-button">
                    ‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                </button>
                <button id="back-btn" class="back-button">
                    ‚¨ÖÔ∏è ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                </button>
            </div>
        </div>

        <!-- Success Section -->
        <div id="success-section" class="success-section" style="display: none;">
            <div class="success-icon">‚úÖ</div>
            <h3>‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h3>
            <p>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß</p>
            <div class="auto-close-info">
                <p>‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏à‡∏∞‡∏õ‡∏¥‡∏î‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÉ‡∏ô <span id="countdown">3</span> ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</p>
            </div>
        </div>

        <!-- Error Section -->
        <div id="error-section" class="error-section" style="display: none;">
            <div class="error-icon">‚ùå</div>
            <h3>‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</h3>
            <p id="error-message">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÑ‡∏î‡πâ</p>
            <button id="retry-btn" class="retry-button">üîÑ ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</button>
        </div>
    </div>
    
    <script>
        // Mock LIFF for testing
        window.liff = {
            init: (config) => {
                console.log('Mock LIFF initialized with config:', config);
                return Promise.resolve();
            },
            isInClient: () => false,
            isLoggedIn: () => true,
            getProfile: () => Promise.resolve({
                userId: 'test-user-123',
                displayName: '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏î‡∏™‡∏≠‡∏ö'
            }),
            closeWindow: () => {
                alert('‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î‡∏à‡∏£‡∏¥‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á LINE ‡∏à‡∏∞‡∏õ‡∏¥‡∏î‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà');
                console.log('LIFF closeWindow called');
            }
        };
        
        // Mock student info for testing
        window.studentInfo = {
            student_id: 12345,
            student_name: '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏î‡∏™‡∏≠‡∏ö',
            student_code: '12345'
        };
        
        // Initialize the form
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Test form loaded');
            
            // Set minimum date to tomorrow
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            const dateInput = document.getElementById('leave-date');
            if (dateInput) {
                dateInput.min = tomorrow.toISOString().split('T')[0];
            }
        });
    </script>
    <script src="./js/date-picker.js"></script>
</body>
</html>