<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="liff-id" content="2008065330-AXGy9xda">
    <meta http-equiv="Permissions-Policy" content="identity-credentials-get=()">
    <title>Safety Bus - ‡πÅ‡∏à‡πâ‡∏á‡∏•‡∏≤‡∏´‡∏¢‡∏∏‡∏î</title>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <!-- Using API endpoints instead of direct Supabase connection -->
    <link rel="stylesheet" href="/css/date-picker.css">
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
    <div class="container">
        <!-- Loading Screen -->
        <div id="loading-screen" class="loading-screen">
            <div class="loading-spinner"></div>
            <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
        </div>

        <!-- Main Form Section -->
        <div id="main-form" class="main-form" style="display: none;">
            <div class="header">
                <h1>üöå Safety Bus</h1>
                <h2>üìù ‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏à‡πâ‡∏á‡∏•‡∏≤‡∏´‡∏¢‡∏∏‡∏î</h2>
            </div>
            
            <!-- Student Info Card -->
            <div class="student-card">
                <h3>üë§ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>
                <div class="student-details">
                    <div class="info-row">
                        <span class="label">‡∏ä‡∏∑‡πà‡∏≠:</span>
                        <span id="student-name" class="value">-</span>
                    </div>
                    <div class="info-row">
                        <span class="label">‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:</span>
                        <span id="student-code" class="value">-</span>
                    </div>
                    <div class="info-row">
                        <span class="label">‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:</span>
                        <span id="student-class" class="value">-</span>
                    </div>

                </div>
            </div>

            <!-- Date Selection Section -->
            <div class="date-selection-card">
                <h3>üìÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏à‡πâ‡∏á‡∏•‡∏≤</h3>
                <div class="date-input-group">
                    <input type="date" id="leave-date" class="date-input">
                    <button id="add-date-btn" class="add-date-button">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</button>
                </div>
                
                <!-- Selected Dates Display -->
                <div id="dates-container" class="dates-container">
                    <p class="no-dates">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</p>
                </div>
                
                <!-- Submit Button -->
                <button id="confirm-btn" class="submit-button" disabled>
                    ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏•‡∏≤
                </button>
            </div>
        </div>

        <!-- Confirmation Section -->
        <div id="confirmation-section" class="confirmation-section" style="display: none;">
            <div class="confirmation-header">
                <h3>‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏•‡∏≤</h3>
            </div>
            
            <div class="confirmation-details">
                <div class="student-summary">
                    <h4>üë§ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h4>
                    <div class="info-row">
                        <span class="label">‡∏ä‡∏∑‡πà‡∏≠:</span>
                        <span id="confirm-student-name" class="value">-</span>
                    </div>
                    <div class="info-row">
                        <span class="label">‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:</span>
                        <span id="confirm-student-code" class="value">-</span>
                    </div>
                    <div class="info-row">
                        <span class="label">‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:</span>
                        <span id="confirm-student-class" class="value">-</span>
                    </div>
                </div>
                
                <div class="dates-summary">
                    <h4>üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏≤</h4>
                    <ul id="confirm-dates-list" class="dates-list">
                        <!-- Dates will be populated here -->
                    </ul>
                </div>
            </div>
            
            <div class="confirmation-buttons">
                <button id="final-confirm-btn" class="final-confirm-button">
                    ‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                </button>
                <button id="back-btn" class="back-button">
                    ‚¨ÖÔ∏è ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                </button>
            </div>
        </div>

        <!-- Success Section -->
        <div id="success-section" class="success-section" style="display: none;">
            <div class="success-icon">‚úÖ</div>
            <h3>‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h3>
            <p>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß</p>
            <div class="auto-close-info">
                <p>‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏à‡∏∞‡∏õ‡∏¥‡∏î‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÉ‡∏ô <span id="countdown">3</span> ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</p>
            </div>
        </div>

        <!-- Error Section -->
        <div id="error-section" class="error-section" style="display: none;">
            <div class="error-icon">‚ùå</div>
            <h3>‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</h3>
            <p id="error-message">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÑ‡∏î‡πâ</p>
            <button id="retry-btn" class="retry-button">üîÑ ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</button>
        </div>
    </div>
    
    <script>
        console.log('üß™ INLINE SCRIPT EXECUTED');
        console.log('üß™ Document ready state:', document.readyState);
        console.log('üß™ LIFF SDK available:', typeof liff !== 'undefined');
        
        // Add global error handler for LIFF
        window.addEventListener('error', function(e) {
            console.error('üö® Global error caught:', e.error);
            if (e.error && e.error.message && e.error.message.includes('LIFF')) {
                console.warn('‚ö†Ô∏è LIFF related error detected, continuing with fallback mode');
            }
        });
        
        // Add unhandled promise rejection handler
        window.addEventListener('unhandledrejection', function(e) {
            console.error('üö® Unhandled promise rejection:', e.reason);
            if (e.reason && e.reason.toString().includes('LIFF')) {
                console.warn('‚ö†Ô∏è LIFF related promise rejection, continuing with fallback mode');
                e.preventDefault(); // Prevent the error from being logged to console
            }
        });
    </script>
    <script src="/js/leave-form.js"></script>
</body>
</html>